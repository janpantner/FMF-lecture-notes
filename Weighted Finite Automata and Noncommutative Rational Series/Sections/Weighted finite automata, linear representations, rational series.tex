\section{Weighted finite automata, linear representations, rational series}

\subsection{Weighted finite automata}

\datum{2024-10-01}

\begin{definition}
    Let $K$ be a semiring and $A$ an alphabet.
    \begin{enumerate}[(1)]
        \item A \emph{weighted (finite) automaton}\index{weighted finite automaton} (WFA) with weights in $K$ 
        is a tuple $(Q, I, E, T)$ consisting of a finite set $Q$ of \emph{states},
        and maps $I \colon Q \rightarrow K$ (\emph{initial weights}), 
        $E \colon Q \times A \times Q \rightarrow K$ (\emph{transition function}),
        $T \colon Q \to K$ (\emph{terminal weights}).
        \item A triple $(p, a, q)$ with $E(p, a, q) \neq 0$ is an 
        \emph{edge/transition} with \emph{label} $a$, \emph{starting state} 
        $p$, \emph{ending state} $q$ and \emph{weight} $E(p, a, q) \in K$.
        \item A \emph{path/run} is a sequence of edges
        $c=(q,a_1, q_1)(q_1, a_2, p_2) \dots (q_{n-1}, a, q_n)$. Its 
        \emph{weight} is 
        \[
            E(q,a_1, q_1)\cdot E(q_1, a_2, p_2) \cdots E(q_{n-1}, a_n, q_n)
        \]
        and its \emph{label} is $w = a_1a_2\dots a_n \in A^*$.
        \item The \emph{behaviour} of $\mathcal{A}$ is the series $[[\mathcal{A}]]
        \in K \left<\left<A\right>\right>$ defined by 
        \[
            ([[\mathcal{A}]], w) = \sum_{q_0, \dots, q_n \in Q} I(q_0)
            E(q,a_1, q_1)E(q_1, a_2, p_2) \cdots E(q_{n-1}, a_n, q_n)T(q_n),
        \]
        where $w = a_1\cdots a_n$, $a_i \in A$.
    \end{enumerate}
\end{definition}

\begin{definition} Terminology:
    \begin{enumerate}
        \item A state $q$ is \emph{initial} if $I(q) \neq 0$ and 
        \emph{terminal}  if $T(q) \neq 0$.
        \item A \emph{successful run/accepting run} is a run from 
        an initial state to a terminal state.
    \end{enumerate}
\end{definition}

\subsection{Linear representation, recognizable series}
We wish to represent the data in a weighted finite automaton using adjacency matrices.
\begin{definition}
    Let $K$ be a semiring and $A$ an alphabet.
    \begin{enumerate}[(1)]
        \item A series $S \in K \left<\left<A\right>\right>$ is \emph{($K$-)recognizable}\index{recognizable series}
        if there exist $n \ge 0$, $\lambda \in K^{1 \times b}$, $\gamma \in K^{n \times 1}$,
        and a monoid morphism $\mu \colon A^* \to K^{d \times d}$ such that for every 
        $w \in A^*$ we have
        \[
            (S, w) = \lambda \mu(w) \gamma.
        \]
        \item The triple $(\lambda, \mu, \gamma)$ is a \emph{linear representation}\index{linear representation}
        of $S$ with \emph{dimension} $n$.
    \end{enumerate}
\end{definition}

\begin{proposition}
    A series $S \in K \left<\left<A\right>\right>$ is recognizable if and only 
    if there exists a WFA $\mathcal{A}$ such that $S = [[\mathcal{A}]]$.
\end{proposition}

\begin{proof}
    Suppose $S = [[\mathcal{A}]]$ with $\mathcal{A} = (Q, I, E, T)$. Without 
    loss of generality let $Q = \set{1, \dots, n}$. Let 
    \[
        \lambda := \begin{bmatrix}
            I(1) & \dots & I(n)
        \end{bmatrix}, \quad \gamma := \begin{bmatrix}
            T(1) & \vdots & T(n)
        \end{bmatrix}^\top,
    \]
    and for every $a \in A$ let 
    \[
        \mu(a) := \begin{bmatrix}
            E(1, a, 1) & \dots & E(1, a, n) \\
            \vdots & & \vdots \\
            E(1, a, n) & \dots & E(n, a, n)
        \end{bmatrix}.
    \]
    This extends to a morphism
    \begin{align*}
        \mu \colon A^* &\to K^{d \times d}, \\
        \mu(a_1 \cdots a_n) &= \mu(a_1)\mu(a_2) \cdots \mu(a_n).
    \end{align*}
    Then, for $p, q \in Q$, $w = a_1 \cdots a_n$, we have
    \begin{align*}
        u(w)_{p,q} &= [
            \mu(a_1) \cdots \mu(a_n)
        ]_{p,q} \\
        &= \sum_{p_1,\dots,p_{m-1} = 1}^{n} \mu(a_1)_{p,p_1}\mu(a_2)_{p_1,p_2} \cdots \mu(a_m)_{p_{m-1},q}
    \end{align*}
    and
    \begin{align*}
        \lambda \mu(w) \gamma &= \sum_{p, p_1,\dots,p_{m-1}, q = 1}^{n} \lambda_p\mu(a_1)_{p,p_1}\mu(a_2)_{p_1,p_2} \cdots \mu(a_m)_{p_{m-1},q} \gamma_q \\
        &= \sum_{p, p_1,\dots,p_{m-1}, q = 1}^{n} I(p) E(p,a_1,p_1)E(p_1,a_2,p_2) \cdots E(p_{m-1},a_m,q)T(q) \\
        &= ([[\mathcal{A}]], w).
    \end{align*}
    Conversly, let $(\lambda, \mu, \gamma)$ be a linear representation recognizing $S$. 
    Let $Q:=\set{1,\dots,n}$, $I(p) := \lambda_p$, $T(q) := \gamma_q$, 
    $E(p,a,q) := \mu(a)_pq$. The computation above shows that $S$ is the 
    behaviour of $(Q, I, E, T)$.
\end{proof}

\subsection{Model-theoretic characterization}

\begin{lemma}
    Let $K$ be a semiring and $A$ an alphabet.
    \begin{enumerate}[(1)]
        \item For $x \in A^*$, the map $S \mapsto x^{-1}X$ is a $K$-module 
        morphism.
        \item For every $x,y \in A^*$ and for every $S \in K \left<\left<A\right>\right>$
        we have $(xy)^{-1}S = y^{-1}(x^{-1}S)$.
    \end{enumerate}
\end{lemma}

\begin{proof}
    Left as an exercise.
\end{proof}

\begin{definition}
    A submodule $M \subseteq K \left<\left<A\right>\right>$ is \emph{stable} 
    if for every $S \in M$ and every $x \in A^*$ we have $x^{-1}S \subseteq M$ (equivalently
    for every $a \in A$ we have $a^{-1}M \subseteq M$).
\end{definition}

\begin{theorem}
    A series $S \in K \left<\left<A\right>\right>$ is recognizable if and only 
    if there exists a stable finitely generated left $K$-submodule $M \subseteq 
    K \left<\left<A\right>\right>$ such that $S \in M$.
\end{theorem}
\datum{2024-10-08}
\begin{proof}
    Next lecture.
\end{proof}
